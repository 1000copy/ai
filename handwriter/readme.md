系统设计问题现在是各个组织面试过程的常规部分。他们测试个人设计、可视化、模拟现实世界场景、使用正确的数据结构、应用设计模式的能力。

这些问题通常是开放式的。通常，面试官要求候选人使用白板设计系统。这甚至可能是一种配对编程，面试官也会提供他的意见。所需设计解决方案的深度取决于面试官。

如果只涉及课程并解释设计概述，一些面试官可能会感到满意。虽然有些人可能会大量地进入实施细节。

因此，在本教程中，我们将设计一个电梯系统，并实施实际解决方案。

## 电梯主背景信息
- 只有一部电梯。不考虑多部电梯的情况
- 电梯服务楼层为1-n，不考虑负数楼层。n为任何大于1的整数
- 初始楼层为1
- 每个楼层有两个按钮分别是上和下，最高层只有下，最底层只有上。按下时对应按钮的背景灯亮，电梯到对应楼层开门接客后，就关闭按钮背景灯
- 电梯内按钮为1-n，分别指示目的楼层。按钮有背景灯，按下时灯亮，到了乘客的楼层，就熄灭对于目的楼层按钮的背景灯
- 电梯每秒走一个楼层
## 我们将模拟以下情景
- 一个人在某一楼层。假设是一楼。他想去 5 楼。因此他点击了向上的电梯按钮。系统记录对应的按钮的方向和楼层，即源楼层。电梯到达源楼层，乘客进入电梯。乘客进入电梯。然后按下电梯中的 5 楼按钮，指示电梯前往 5 楼。即目的地楼层。电梯到达 5 楼。然后乘客走出电梯。进入空闲状态。
- 假设电梯从一楼运行到五楼。此时，假设二楼的另一个人想要往上走。那么电梯会因这个要求而停止，二楼的人将进入电梯。假设他按下了 4 楼的按钮。那么电梯将首先停在 4 楼，也就是二楼进入者的目的地。随后电梯停在五楼，一楼的人走出电梯。进入空闲状态
- 假设电梯从一楼运行到五楼。此时，假设二楼的另一个人想要往下走到一楼，那么电梯不会因这个要求而停止，电梯停在五楼，一楼的人走出电梯。然后电梯向下到2楼，二楼的人将进入电梯，假设他按下了 1楼的按钮。那么电梯将停在 1楼也，就是二楼进入者的目的地。随后进入空闲状态

## 对象
- Button对象，有一个on属性，true表示被按下背景灯亮，false为背景灯关闭
- Floor对象，有一个数字索引只是楼层对应楼层。一个Elavator有N个Floor，N为楼层高度。楼层对象包括两个Button，一个上一个下。upbtn和downvtn
- Elevator对象，包括N个电梯内Button，对应按钮按下表示为去往的目的楼层索引。
- State对象包括idle和running

## 算法
- 当楼层按钮按下时，系统设置此楼层对象Floor的对应Button为on为真。到待服务楼层内。如果电梯空闲且此按钮是第一个按下的按钮，则电梯开始运行，方向根据此楼层按钮和当前位置的关系来决定，如果前者大于后者则向上，等于就保持不动，小于则向下
- 当电梯内按钮按下时，系统登记此目的楼层到待到达楼层并继续原方向运行。如果没有待服务楼层，那么方向由当前楼层和待到达楼层是关系决定。前者大于后者则向上否则向下相等就静止于当前楼层。
- 等电梯运行时，定时器定期检查，逐个检查待服务楼层，如果方向一致且等于当前楼层，就开门接客并从待服务楼层删除此楼层；逐个检查待到达楼层，如果等于当前楼层，就开门送客并从待到达楼层删除此楼层；如果待服务楼层和待到达楼层为空，则电梯停止于当前楼层。

## 附录：思考细节

以电梯算法为例如何使用UML完成系统设计提升软件质量？➕uml表达➕状态图表达➕流程图表达➕如何从测试用例开始做逐步求精？

每次坐电梯上都会想电梯算法如何设计的。但是都没有想清楚，其他事一来好奇心就放下了。并且有一个认识就是我不是天才仅仅靠脑子想一下是想不明白的

用头脑去想是不够的，因为显然电梯算法不是那么简单，需要状态➕事件➕动作，其中状态变量还不少呢


从最简单的测试用例开始，是一个逐步求精的好办法。

第一个最简单的测试用例

八层楼电梯处于静止状态，停在一楼。有人在七楼按向下按钮，电梯上行到七楼开门，用户进入电梯按一楼，电梯关门，下行到一楼并开门，用户退出，电梯关门。

一个测试用例虽然简单，没有考虑到多人按电梯也没有考虑到电梯已经在上行也没有考虑到任何异常条件比如用户进来后一直没有按电梯内按钮。

但是他体现出来很多东西，比如电梯得有状态包括停止上行下行，和当前位置楼层，电梯有电梯内按钮和楼层按钮，电梯有开门行为和关门行为和上行行为下行行为。于是就可以编类图了。

第一批类图出来，就可以继续增加更多的测试用例，考虑更多系统的行为和状态，于是继续在增加原来没有考虑到的属性和行为。

一轮一轮下来，当更多用例通过，情况考虑更加完善，就可以完成更多的类图和相关的uml设计图。

在图形表达设计完成并通过自检即系统设计完成。此设计阶段完成。开始编码。

更多用例


八层楼电梯处于静止状态，停在一楼。有人在七楼按向下按钮，接着五楼有人按下行按钮。电梯上行到七楼开门，用户进入电梯按一楼，电梯关门，下行到五楼开门。用户进入没有按按钮。电梯关门并下行到一楼并开门，用户退出，电梯关门并静止。


八层楼电梯处于静止状态，停在一楼。有人在七楼按向下按钮，接着有人在五楼按上行。电梯上行到五楼开门，用户进入电梯按八楼，电梯关门，上行到八楼开门用户退出。电梯关门下行到七楼开门，用户进入电梯关门下行到一楼并开门，用户退出，电梯关门并静止。


懒得继续写了。是这些用例的目的是为了熟悉电梯算法的算法引出系统内部需要的状态，并写出更加详细的需求这些需求应该具备更强的通用型而不是一个个具体的场景因此是更加抽象的表达。比如按钮默认就是八层楼是太具体的不够抽象因此也就不够应用。


比如电梯共有m层，电梯按钮有m➕2个其中两个是开门和关门按钮其他是1234…m数字代表目的楼层，楼层有两个按钮一个上行一个下行最高层只有下行按钮最底层只有上行按钮。

就到这里也就知道为什么仅仅头脑内推演出来很难了。因为要考虑的已经不只是七个点了比这多的多了并且这些概念是有多个层次的了。

UML需要来救驾来。

到目前为止，有哪些对象已经浮出水面了？

电梯对象 属性包括楼层总数 楼层按钮数组，电梯内按钮数组 ，当前楼层，状态包括静止上行下行 行为包括上行下行开门关门。事件包括楼层上行按钮被按下 楼层下行按钮被按下 电梯内按钮被按下

楼层按钮数组，电梯内按钮数组 ，是推导出来的属性可以先不考虑。于是改一改。

电梯对象 属性包括楼层总数，当前楼层，状态包括静止上行下行 行为包括上行下行开门关门。事件包括楼层上行按钮被按下 楼层下行按钮被按下 电梯内按钮被按下。

现在拿着这个对象，重新过下用例。

从最简单的开始。也就是

八层楼电梯处于静止状态，停在一楼。有人在七楼按向下按钮，电梯上行到七楼开门，用户进入电梯按一楼，电梯关门，下行到一楼并开门，用户退出，电梯关门。

八层楼电梯处于静止状态停在一楼，（电梯对象初始化总楼层为八，初始状态为静止，初始位置为1）有人在七楼按向下按钮（事件发生，事件是楼层按钮被按下楼层为7）电梯上行（电梯发现按下行按钮的楼层大于当前楼层所以判断为上行状态改为上行）到七楼开门（每到一个楼层都检查是否楼层按钮被按下并且按钮和当前状态一致如果一致就开门并熄灭楼层按钮）用户进入电梯按一楼，电梯关门，下行到一楼（电梯按钮被按下如果大于当前楼层就上行如果等于当前楼层就熄灭按钮并且开门如果小于楼层就下行，行进过程中检查目的楼层是否到达如果到达就开门熄灭按钮）并开门，用户退出，电梯关门。


因为有了对象的定义，描述的用例经过括号内文字变得更加抽象和更加同样，更像是一般化的用户需求了。


且这些抽象的需求显然描述用例过程中已经开始有些可以重用的内容了。拆解可以开始了。重用的就是“行进过程中检查目的楼层是否到达如果到达就开门熄灭按”

抽象后的需求：


电梯共m层，初始电梯处于静止状态停在n楼，有人在p楼按向下按钮，如果p大于当前楼层n，那么转为上行状态并开始上行，如果p等于n就开门，如果p小于n就下行。每到一个楼层都检查是否楼层按钮被按下并且按钮和当前状态一致，如果一致就开门并熄灭楼层按钮。用户进入电梯按x楼，电梯关门，如果电梯按钮x被按下x大于当前楼层就上行如果等于当前楼层就熄灭按钮并且开门如果小于楼层就下行，行进过程中检查目的楼层是否到达如果到达就开门熄灭按钮，并开门，用户退出，电梯关门。

此时可以开始拆状态了，因为在静止太多行为是可以重用的，在运行态的状态也是可以重用的。他们拆解后，在组合起来就可以重用化的完成此用例了。

此时我停下来。目前还在问题定义阶段，仅仅是定义问题就已经这么复杂了。我开始想到协作图状态图流程图了。

逻辑更加通用了但是也更加复杂难以理解了，这些描述开始离用户感知越来越远了。代数和参数一旦开始，单纯的文字已经不易表达了。

不如代码来表达来痛快些。

找时间写代码去。

下回分解

一

忍住冲动，先画一张状态图试试表达效果。





